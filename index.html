<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Payment Mini App</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: var(--tg-theme-bg-color, #ffffff);
            color: var(--tg-theme-text-color, #000000);
            min-height: 100vh;
        }
        
        .container {
            max-width: 400px;
            margin: 0 auto;
        }
        
        .card {
            background: var(--tg-theme-secondary-bg-color, #f1f1f1);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .product {
            text-align: center;
            padding: 20px;
        }
        
        .product-image {
            width: 100px;
            height: 100px;
            background: var(--tg-theme-button-color, #2481cc);
            border-radius: 50%;
            margin: 0 auto 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 48px;
        }
        
        .price {
            font-size: 32px;
            font-weight: bold;
            color: var(--tg-theme-button-color, #2481cc);
            margin: 10px 0;
        }
        
        .button {
            background: var(--tg-theme-button-color, #2481cc);
            color: var(--tg-theme-button-text-color, #ffffff);
            border: none;
            border-radius: 12px;
            padding: 16px 32px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            margin: 10px 0;
            transition: opacity 0.2s;
        }
        
        .button:hover {
            opacity: 0.8;
        }
        
        .button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .status {
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            font-weight: bold;
            text-align: center;
        }
        
        .status.success {
            background: #d4edda;
            color: #155724;
        }
        
        .status.error {
            background: #f8d7da;
            color: #721c24;
        }
        
        .status.info {
            background: #d1ecf1;
            color: #0c5460;
        }
        
        .debug {
            background: #1a1a1a;
            color: #00ff00;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            height: 150px;
            overflow-y: auto;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="card">
            <h1>üí≥ Payment Mini App</h1>
            <p>–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –ø–ª–∞—Ç–µ–∂–Ω—ã—Ö –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π Telegram</p>
            <div id="status" class="status info">–ì–æ—Ç–æ–≤ –∫ –æ–ø–ª–∞—Ç–µ</div>
        </div>
        
        <div class="card product">
            <div class="product-image">üéÅ</div>
            <h2>–ü—Ä–µ–º–∏—É–º –ø–æ–¥–ø–∏—Å–∫–∞</h2>
            <p>–ü–æ–ª—É—á–∏—Ç–µ –¥–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–º —Ñ—É–Ω–∫—Ü–∏—è–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è</p>
            <div class="price">99 ‚≠ê</div>
            <p><small>Telegram Stars</small></p>
            
            <button class="button" id="payButton" onclick="initiatePayment()">
                üí≥ –û–ø–ª–∞—Ç–∏—Ç—å
            </button>
        </div>
        
        <div class="card">
            <h3>‚ÑπÔ∏è –û –ø–ª–∞—Ç–µ–∂–µ</h3>
            <p><strong>–¢–æ–≤–∞—Ä:</strong> –ü—Ä–µ–º–∏—É–º –ø–æ–¥–ø–∏—Å–∫–∞</p>
            <p><strong>–¶–µ–Ω–∞:</strong> 99 Telegram Stars</p>
            <p><strong>–û–ø–∏—Å–∞–Ω–∏–µ:</strong> –ú–µ—Å—è—á–Ω–∞—è –ø–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –ø—Ä–µ–º–∏—É–º —Ñ—É–Ω–∫—Ü–∏–∏</p>
        </div>
        
        <div class="card">
            <h3>üêõ –û—Ç–ª–∞–¥–∫–∞</h3>
            <div class="debug" id="debug"></div>
            <button class="button" onclick="clearDebug()" style="background: #6c757d;">
                üßπ –û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥
            </button>
        </div>
    </div>

    <script>
        let tg = window.Telegram.WebApp;
        
        function log(message) {
            const timestamp = new Date().toLocaleTimeString();
            console.log(`[${timestamp}] ${message}`);
            
            const debugEl = document.getElementById('debug');
            debugEl.innerHTML += `<div>${timestamp}: ${message}</div>`;
            debugEl.scrollTop = debugEl.scrollHeight;
        }
        
        function updateStatus(message, type = 'info') {
            const statusEl = document.getElementById('status');
            statusEl.textContent = message;
            statusEl.className = `status ${type}`;
            log(`STATUS [${type.toUpperCase()}]: ${message}`);
        }
        
        function init() {
            log("üöÄ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Payment Mini App...");
            
            try {
                tg.ready();
                tg.expand();
                
                log("‚úÖ –ë–∞–∑–æ–≤–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞");
                log("üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: " + (tg.initDataUnsafe?.user?.first_name || "–ù–µ–∏–∑–≤–µ—Å—Ç–µ–Ω"));
                log("üÜî User ID: " + (tg.initDataUnsafe?.user?.id || "–ù–µ–∏–∑–≤–µ—Å—Ç–µ–Ω"));
                
                updateStatus("‚úÖ –ì–æ—Ç–æ–≤ –∫ –æ–ø–ª–∞—Ç–µ", "success");
                
            } catch (error) {
                log("‚ùå –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏: " + error.message);
                updateStatus("‚ùå –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏", "error");
            }
        }
        
        function initiatePayment() {
            log("üí≥ === –ù–ê–ß–ê–õ–û –ü–õ–ê–¢–ï–ñ–ê ===");
            
            updateStatus("‚è≥ –ò–Ω–∏—Ü–∏–∞—Ü–∏—è –ø–ª–∞—Ç–µ–∂–∞...", "info");
            
            // –û—Ç–∫–ª—é—á–∞–µ–º –∫–Ω–æ–ø–∫—É –Ω–∞ –≤—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏
            const payButton = document.getElementById('payButton');
            payButton.disabled = true;
            payButton.textContent = "‚è≥ –û–±—Ä–∞–±–æ—Ç–∫–∞...";
            
            try {
                // –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–ª–∞—Ç–µ–∂–∞
                const invoiceParams = {
                    title: "–ü—Ä–µ–º–∏—É–º –ø–æ–¥–ø–∏—Å–∫–∞",
                    description: "–ú–µ—Å—è—á–Ω–∞—è –ø–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –ø—Ä–µ–º–∏—É–º —Ñ—É–Ω–∫—Ü–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è",
                    currency: "XTR", // Telegram Stars
                    prices: [
                        {
                            label: "–ü—Ä–µ–º–∏—É–º –ø–æ–¥–ø–∏—Å–∫–∞",
                            amount: 99 // 99 Telegram Stars
                        }
                    ],
                    payload: JSON.stringify({
                        user_id: tg.initDataUnsafe?.user?.id,
                        product: "premium_subscription",
                        duration: "1_month",
                        timestamp: new Date().toISOString()
                    })
                };
                
                log("üìã –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–ª–∞—Ç–µ–∂–∞:");
                log(JSON.stringify(invoiceParams, null, 2));
                
                // –û—Ç–∫—Ä—ã–≤–∞–µ–º –ø–ª–∞—Ç–µ–∂–Ω—É—é —Ñ–æ—Ä–º—É
                tg.openInvoice(invoiceParams.title, invoiceParams.description, invoiceParams.payload, "provider_token", invoiceParams.currency, invoiceParams.prices, (status) => {
                    log("üí≥ Callback –ø–ª–∞—Ç–µ–∂–∞ –ø–æ–ª—É—á–µ–Ω: " + status);
                    handlePaymentCallback(status);
                });
                
                log("‚úÖ –ü–ª–∞—Ç–µ–∂–Ω–∞—è —Ñ–æ—Ä–º–∞ –æ—Ç–∫—Ä—ã—Ç–∞");
                updateStatus("üí≥ –ü–ª–∞—Ç–µ–∂–Ω–∞—è —Ñ–æ—Ä–º–∞ –æ—Ç–∫—Ä—ã—Ç–∞", "info");
                
            } catch (error) {
                log("‚ùå –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞—Ü–∏–∏ –ø–ª–∞—Ç–µ–∂–∞: " + error.message);
                updateStatus("‚ùå –û—à–∏–±–∫–∞ –ø–ª–∞—Ç–µ–∂–∞", "error");
                
                // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –∫–Ω–æ–ø–∫—É –≤ –∏—Å—Ö–æ–¥–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
                payButton.disabled = false;
                payButton.textContent = "üí≥ –û–ø–ª–∞—Ç–∏—Ç—å";
            }
        }
        
        function handlePaymentCallback(status) {
            log("üìû === –û–ë–†–ê–ë–û–¢–ö–ê –†–ï–ó–£–õ–¨–¢–ê–¢–ê –ü–õ–ê–¢–ï–ñ–ê ===");
            log("üìä –°—Ç–∞—Ç—É—Å: " + status);
            
            const payButton = document.getElementById('payButton');
            
            switch (status) {
                case 'paid':
                    log("‚úÖ –ü–ª–∞—Ç–µ–∂ —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω!");
                    updateStatus("üéâ –ü–ª–∞—Ç–µ–∂ —É—Å–ø–µ—à–µ–Ω!", "success");
                    payButton.textContent = "‚úÖ –û–ø–ª–∞—á–µ–Ω–æ";
                    payButton.style.background = "#28a745";
                    
                    // –í–∏–±—Ä–∞—Ü–∏—è —É—Å–ø–µ—Ö–∞
                    if (tg.HapticFeedback) {
                        tg.HapticFeedback.notificationOccurred('success');
                    }
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
                    setTimeout(() => {
                        tg.showAlert("üéâ –°–ø–∞—Å–∏–±–æ –∑–∞ –ø–æ–∫—É–ø–∫—É! –ü—Ä–µ–º–∏—É–º —Ñ—É–Ω–∫—Ü–∏–∏ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω—ã.");
                    }, 500);
                    
                    break;
                    
                case 'cancelled':
                    log("‚ùå –ü–ª–∞—Ç–µ–∂ –æ—Ç–º–µ–Ω–µ–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º");
                    updateStatus("‚ùå –ü–ª–∞—Ç–µ–∂ –æ—Ç–º–µ–Ω–µ–Ω", "error");
                    payButton.disabled = false;
                    payButton.textContent = "üí≥ –û–ø–ª–∞—Ç–∏—Ç—å";
                    
                    if (tg.HapticFeedback) {
                        tg.HapticFeedback.notificationOccurred('error');
                    }
                    
                    break;
                    
                case 'failed':
                    log("‚ùå –ü–ª–∞—Ç–µ–∂ –Ω–µ —É–¥–∞–ª—Å—è");
                    updateStatus("‚ùå –û—à–∏–±–∫–∞ –ø–ª–∞—Ç–µ–∂–∞", "error");
                    payButton.disabled = false;
                    payButton.textContent = "üí≥ –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞";
                    
                    if (tg.HapticFeedback) {
                        tg.HapticFeedback.notificationOccurred('error');
                    }
                    
                    tg.showAlert("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –ø–ª–∞—Ç–µ–∂. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.");
                    
                    break;
                    
                case 'pending':
                    log("‚è≥ –ü–ª–∞—Ç–µ–∂ –≤ –æ–±—Ä–∞–±–æ—Ç–∫–µ");
                    updateStatus("‚è≥ –ü–ª–∞—Ç–µ–∂ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è...", "info");
                    payButton.textContent = "‚è≥ –û–±—Ä–∞–±–æ—Ç–∫–∞...";
                    
                    break;
                    
                default:
                    log("‚ùì –ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —Å—Ç–∞—Ç—É—Å –ø–ª–∞—Ç–µ–∂–∞: " + status);
                    updateStatus("‚ùì –ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —Å—Ç–∞—Ç—É—Å", "error");
                    payButton.disabled = false;
                    payButton.textContent = "üí≥ –û–ø–ª–∞—Ç–∏—Ç—å";
            }
            
            log("üèÅ –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–ª–∞—Ç–µ–∂–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞");
        }
        
        function clearDebug() {
            document.getElementById('debug').innerHTML = '';
            log("üßπ –õ–æ–≥ –æ—á–∏—â–µ–Ω");
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', function() {
            log("üìÑ DOM –∑–∞–≥—Ä—É–∂–µ–Ω, –∑–∞–ø—É—Å–∫–∞–µ–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é...");
            init();
        });
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –ø–ª–∞—Ç–µ–∂–µ–π
        tg.onEvent('invoiceClosed', function(eventData) {
            log("üßæ –°–æ–±—ã—Ç–∏–µ invoiceClosed: " + JSON.stringify(eventData));
            
            if (eventData.status === 'paid') {
                log("üí∞ –ü–ª–∞—Ç–µ–∂ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω —á–µ—Ä–µ–∑ —Å–æ–±—ã—Ç–∏–µ");
            }
        });
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥—Ä—É–≥–∏—Ö —Å–æ–±—ã—Ç–∏–π
        tg.onEvent('themeChanged', function() {
            log("üé® –¢–µ–º–∞ –∏–∑–º–µ–Ω–µ–Ω–∞");
        });
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
        window.addEventListener('error', function(e) {
            log("üí• JavaScript –æ—à–∏–±–∫–∞: " + e.message);
            updateStatus("‚ùå JavaScript –æ—à–∏–±–∫–∞", "error");
        });
    </script>
</body>
</html>
