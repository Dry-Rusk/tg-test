<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Mini App</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: var(--tg-theme-bg-color, #ffffff);
            color: var(--tg-theme-text-color, #000000);
            min-height: 100vh;
        }
        
        .container {
            max-width: 400px;
            margin: 0 auto;
        }
        
        .card {
            background: var(--tg-theme-secondary-bg-color, #f1f1f1);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .button {
            background: var(--tg-theme-button-color, #2481cc);
            color: var(--tg-theme-button-text-color, #ffffff);
            border: none;
            border-radius: 8px;
            padding: 12px 24px;
            font-size: 16px;
            cursor: pointer;
            width: 100%;
            margin: 10px 0;
        }
        
        .button:hover {
            opacity: 0.8;
        }
        
        .info {
            background: var(--tg-theme-secondary-bg-color, #f1f1f1);
            padding: 10px;
            border-radius: 8px;
            margin: 10px 0;
            font-size: 14px;
        }
        
        .counter {
            font-size: 48px;
            text-align: center;
            margin: 20px 0;
            color: var(--tg-theme-button-color, #2481cc);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="card">
            <h1>üöÄ Test Mini App</h1>
            <p>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ —Ç–µ—Å—Ç–æ–≤–æ–µ –º–∏–Ω–∏-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ!</p>
        </div>
        
        <div class="card">
            <h2>–°—á–µ—Ç—á–∏–∫</h2>
            <div class="counter" id="counter">0</div>
            <button class="button" onclick="incrementCounter()">–£–≤–µ–ª–∏—á–∏—Ç—å —Å—á–µ—Ç—á–∏–∫</button>
            <button class="button" onclick="resetCounter()">–°–±—Ä–æ—Å–∏—Ç—å</button>
        </div>
        
        <div class="card">
            <h2>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ</h2>
            <div class="info" id="userInfo">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
        </div>
        
        <div class="card">
            <h2>–î–µ–π—Å—Ç–≤–∏—è</h2>
            <button class="button" onclick="showAlert()">–ü–æ–∫–∞–∑–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ</button>
            <button class="button" onclick="sendData()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –±–æ—Ç—É</button>
            <button class="button" onclick="closeApp()">–ó–∞–∫—Ä—ã—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ</button>
        </div>
        
        <div class="info">
            <strong>–í–µ—Ä—Å–∏—è Telegram WebApp:</strong> <span id="version"></span><br>
            <strong>–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞:</strong> <span id="platform"></span>
        </div>
        
        <!-- –ü–∞–Ω–µ–ª—å –æ—Ç–ª–∞–¥–∫–∏ -->
        <div class="card">
            <h2>üêõ –û—Ç–ª–∞–¥–∫–∞</h2>
            <div id="debug-info" style="height: 150px; overflow-y: auto; background: #f0f0f0; padding: 10px; border-radius: 5px; font-family: monospace; font-size: 12px;"></div>
            <button class="button" onclick="clearDebug()">–û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥</button>
            <button class="button" onclick="showDebugInfo()">–ü–æ–∫–∞–∑–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é</button>
            <button class="button" onclick="exportLogs()">–≠–∫—Å–ø–æ—Ä—Ç –ª–æ–≥–æ–≤</button>
        </div>
    </div>

    <script>
        let counter = 0;
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è —Å –æ—Ç–ø—Ä–∞–≤–∫–æ–π –Ω–∞ —Å–µ—Ä–≤–µ—Ä
        function debugLog(message, data = null) {
            const logEntry = `[${new Date().toISOString()}] ${message}`;
            console.log(logEntry, data);
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ
            const debugElement = document.getElementById('debug-info');
            if (debugElement) {
                const timestamp = new Date().toLocaleTimeString();
                debugElement.innerHTML += `<div>${timestamp}: ${message}</div>`;
                debugElement.scrollTop = debugElement.scrollHeight;
            }
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ localStorage –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞
            try {
                const logs = JSON.parse(localStorage.getItem('miniapp_logs') || '[]');
                logs.push({ timestamp: new Date().toISOString(), message, data });
                // –û—Å—Ç–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 100 –∑–∞–ø–∏—Å–µ–π
                if (logs.length > 100) logs.splice(0, logs.length - 100);
                localStorage.setItem('miniapp_logs', JSON.stringify(logs));
            } catch (e) {
                console.warn('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –ª–æ–≥ –≤ localStorage');
            }
        }
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å Telegram WebApp
        if (!window.Telegram) {
            debugLog("‚ùå –û–®–ò–ë–ö–ê: window.Telegram –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω!");
        } else if (!window.Telegram.WebApp) {
            debugLog("‚ùå –û–®–ò–ë–ö–ê: window.Telegram.WebApp –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω!");
        } else {
            debugLog("‚úÖ Telegram WebApp API –¥–æ—Å—Ç—É–ø–µ–Ω");
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram WebApp
        const tg = window.Telegram?.WebApp;
        
        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
        if (tg) {
            debugLog("üîß –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å...");
            tg.ready();
            tg.expand();
            debugLog("‚úÖ tg.ready() –∏ tg.expand() –≤—ã–ø–æ–ª–Ω–µ–Ω—ã");
            
            // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≥–ª–∞–≤–Ω–æ–π –∫–Ω–æ–ø–∫–∏
            tg.MainButton.text = "–û—Ç–ø—Ä–∞–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ";
            tg.MainButton.show();
            tg.MainButton.onClick(() => {
                debugLog("üîò –ì–ª–∞–≤–Ω–∞—è –∫–Ω–æ–ø–∫–∞ –Ω–∞–∂–∞—Ç–∞");
                sendData();
            });
            debugLog("‚úÖ –ì–ª–∞–≤–Ω–∞—è –∫–Ω–æ–ø–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞");
        } else {
            debugLog("‚ùå tg –æ–±—ä–µ–∫—Ç –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫—É");
        }
        
        // –§—É–Ω–∫—Ü–∏–∏ —Å—á–µ—Ç—á–∏–∫–∞
        function incrementCounter() {
            counter++;
            document.getElementById('counter').textContent = counter;
            
            // –î–æ–±–∞–≤–ª—è–µ–º haptic feedback
            if (tg.HapticFeedback) {
                tg.HapticFeedback.impactOccurred('light');
            }
        }
        
        function resetCounter() {
            counter = 0;
            document.getElementById('counter').textContent = counter;
            
            if (tg.HapticFeedback) {
                tg.HapticFeedback.notificationOccurred('success');
            }
        }
        
        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
        function displayUserInfo() {
            const user = tg.initDataUnsafe.user;
            const userInfoElement = document.getElementById('userInfo');
            
            if (user) {
                userInfoElement.innerHTML = `
                    <strong>–ò–º—è:</strong> ${user.first_name || '–ù–µ —É–∫–∞–∑–∞–Ω–æ'}<br>
                    <strong>–§–∞–º–∏–ª–∏—è:</strong> ${user.last_name || '–ù–µ —É–∫–∞–∑–∞–Ω–æ'}<br>
                    <strong>Username:</strong> @${user.username || '–ù–µ —É–∫–∞–∑–∞–Ω'}<br>
                    <strong>ID:</strong> ${user.id}<br>
                    <strong>–Ø–∑—ã–∫:</strong> ${user.language_code || '–ù–µ —É–∫–∞–∑–∞–Ω'}
                `;
            } else {
                userInfoElement.textContent = '–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞';
            }
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
        function showAlert() {
            tg.showAlert(`–ü—Ä–∏–≤–µ—Ç! –°—á–µ—Ç—á–∏–∫ —Å–µ–π—á–∞—Å —Ä–∞–≤–µ–Ω ${counter}`);
        }
        
        // –û—Ç–ø—Ä–∞–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –±–æ—Ç—É
        function sendData() {
            debugLog("üì§ –ù–∞—á–∏–Ω–∞–µ–º –æ—Ç–ø—Ä–∞–≤–∫—É –¥–∞–Ω–Ω—ã—Ö...");
            
            if (!tg) {
                debugLog("‚ùå tg –æ–±—ä–µ–∫—Ç –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω!");
                alert("–û—à–∏–±–∫–∞: Telegram WebApp –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω");
                return;
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –º—ã –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –≤ Telegram
            if (!tg.initDataUnsafe || Object.keys(tg.initDataUnsafe).length === 0) {
                debugLog("‚ùå initDataUnsafe –ø—É—Å—Ç! –í–æ–∑–º–æ–∂–Ω–æ, –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –æ—Ç–∫—Ä—ã—Ç–æ –Ω–µ –∏–∑ Telegram");
                alert("–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –æ—Ç–∫—Ä—ã—Ç–æ –∏–∑ Telegram!");
                return;
            }
            
            const data = {
                counter: counter,
                timestamp: new Date().toISOString(),
                user_id: tg.initDataUnsafe?.user?.id,
                debug: true,
                from_telegram: true
            };
            
            debugLog("üìã –ü–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:", data);
            
            try {
                const jsonData = JSON.stringify(data);
                debugLog("üìÑ JSON –¥–∞–Ω–Ω—ã–µ:", jsonData);
                debugLog("üì° –†–∞–∑–º–µ—Ä –¥–∞–Ω–Ω—ã—Ö:", jsonData.length + " —Å–∏–º–≤–æ–ª–æ–≤");
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Ñ—É–Ω–∫—Ü–∏–∏ sendData
                if (typeof tg.sendData !== 'function') {
                    debugLog("‚ùå tg.sendData –Ω–µ —è–≤–ª—è–µ—Ç—Å—è —Ñ—É–Ω–∫—Ü–∏–µ–π!");
                    alert("–û—à–∏–±–∫–∞: sendData –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω");
                    return;
                }
                
                // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ
                tg.sendData(jsonData);
                debugLog("‚úÖ tg.sendData() –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ");
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é, —á—Ç–æ –¥–∞–Ω–Ω—ã–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã
                tg.showAlert("–î–∞–Ω–Ω—ã–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã –±–æ—Ç—É!");
                
            } catch (error) {
                debugLog("üí• –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ:", error);
                alert("–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏: " + error.message);
            }
        }
        
        // –§—É–Ω–∫—Ü–∏–∏ –æ—Ç–ª–∞–¥–∫–∏
        function clearDebug() {
            document.getElementById('debug-info').innerHTML = '';
            localStorage.removeItem('miniapp_logs');
            debugLog("üßπ –õ–æ–≥ –æ—á–∏—â–µ–Ω");
        }
        
        function showDebugInfo() {
            const info = {
                isTelegram: !!window.Telegram,
                isWebApp: !!window.Telegram?.WebApp,
                version: tg?.version,
                platform: tg?.platform,
                user: tg?.initDataUnsafe?.user,
                isExpanded: tg?.isExpanded,
                viewportHeight: tg?.viewportHeight,
                mainButtonVisible: tg?.MainButton?.isVisible,
                url: window.location.href,
                userAgent: navigator.userAgent,
                // –í–ê–ñ–ù–´–ï –ü–†–û–í–ï–†–ö–ò:
                hasInitData: !!tg?.initData,
                hasInitDataUnsafe: !!tg?.initDataUnsafe,
                initDataLength: tg?.initData?.length || 0,
                sendDataExists: typeof tg?.sendData === 'function'
            };
            
            debugLog("üìä –ü–æ–ª–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–æ—Å—Ç–æ—è–Ω–∏–∏:", info);
            
            // –°–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö
            if (!info.hasInitData || info.initDataLength === 0) {
                debugLog("‚ö†Ô∏è –í–ù–ò–ú–ê–ù–ò–ï: initData –ø—É—Å—Ç! –í–æ–∑–º–æ–∂–Ω–æ, –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –æ—Ç–∫—Ä—ã—Ç–æ –Ω–µ –∏–∑ Telegram");
                alert("‚ö†Ô∏è –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –æ—Ç–∫—Ä—ã—Ç–æ –∏–∑ Telegram –±–æ—Ç–∞!");
            }
            
            if (!info.sendDataExists) {
                debugLog("‚ùå –û–®–ò–ë–ö–ê: —Ñ—É–Ω–∫—Ü–∏—è sendData –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞!");
            }
        }
        
        function exportLogs() {
            try {
                const logs = localStorage.getItem('miniapp_logs');
                if (logs) {
                    const blob = new Blob([logs], { type: 'application/json' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `miniapp_logs_${new Date().toISOString().slice(0,10)}.json`;
                    a.click();
                    URL.revokeObjectURL(url);
                    debugLog("üì• –õ–æ–≥–∏ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã");
                } else {
                    debugLog("üì≠ –ù–µ—Ç –ª–æ–≥–æ–≤ –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞");
                }
            } catch (e) {
                debugLog("‚ùå –û—à–∏–±–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞ –ª–æ–≥–æ–≤: " + e.message);
            }
        }
        
        // –ó–∞–∫—Ä—ã—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
        function closeApp() {
            tg.close();
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', function() {
            debugLog("üöÄ DOM –∑–∞–≥—Ä—É–∂–µ–Ω, –Ω–∞—á–∏–Ω–∞–µ–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é...");
            
            displayUserInfo();
            
            if (tg) {
                // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤–µ—Ä—Å–∏–∏ –∏ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã
                document.getElementById('version').textContent = tg.version || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ';
                document.getElementById('platform').textContent = tg.platform || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ';
                
                // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç–µ–º—ã
                document.body.style.backgroundColor = tg.themeParams?.bg_color || '#ffffff';
                document.body.style.color = tg.themeParams?.text_color || '#000000';
                
                debugLog("‚úÖ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ");
                debugLog("üì± –í–µ—Ä—Å–∏—è: " + tg.version);
                debugLog("üñ•Ô∏è –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞: " + tg.platform);
            } else {
                debugLog("‚ùå –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å –æ—à–∏–±–∫–∞–º–∏ - tg –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω");
                document.getElementById('version').textContent = '–û—à–∏–±–∫–∞';
                document.getElementById('platform').textContent = '–û—à–∏–±–∫–∞';
            }
        });
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏–π Telegram WebApp
        tg.onEvent('themeChanged', function() {
            document.body.style.backgroundColor = tg.themeParams.bg_color;
            document.body.style.color = tg.themeParams.text_color;
        });
        
        tg.onEvent('viewportChanged', function() {
            console.log('Viewport changed:', tg.viewportHeight, tg.viewportStableHeight);
        });
    </script>
</body>
</html>
