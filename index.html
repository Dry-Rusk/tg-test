<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Mini App</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: var(--tg-theme-bg-color, #ffffff);
            color: var(--tg-theme-text-color, #000000);
            min-height: 100vh;
        }
        
        .container {
            max-width: 400px;
            margin: 0 auto;
        }
        
        .card {
            background: var(--tg-theme-secondary-bg-color, #f1f1f1);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .button {
            background: var(--tg-theme-button-color, #2481cc);
            color: var(--tg-theme-button-text-color, #ffffff);
            border: none;
            border-radius: 8px;
            padding: 12px 24px;
            font-size: 16px;
            cursor: pointer;
            width: 100%;
            margin: 10px 0;
        }
        
        .button:hover {
            opacity: 0.8;
        }
        
        .info {
            background: var(--tg-theme-secondary-bg-color, #f1f1f1);
            padding: 10px;
            border-radius: 8px;
            margin: 10px 0;
            font-size: 14px;
        }
        
        .counter {
            font-size: 48px;
            text-align: center;
            margin: 20px 0;
            color: var(--tg-theme-button-color, #2481cc);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="card">
            <h1>üöÄ Test Mini App</h1>
            <p>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ —Ç–µ—Å—Ç–æ–≤–æ–µ –º–∏–Ω–∏-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ!</p>
        </div>
        
        <div class="card">
            <h2>–°—á–µ—Ç—á–∏–∫</h2>
            <div class="counter" id="counter">0</div>
            <button class="button" onclick="incrementCounter()">–£–≤–µ–ª–∏—á–∏—Ç—å —Å—á–µ—Ç—á–∏–∫</button>
            <button class="button" onclick="resetCounter()">–°–±—Ä–æ—Å–∏—Ç—å</button>
        </div>
        
        <div class="card">
            <h2>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ</h2>
            <div class="info" id="userInfo">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
        </div>
        
        <div class="card">
            <h2>–î–µ–π—Å—Ç–≤–∏—è</h2>
            <button class="button" onclick="showAlert()">–ü–æ–∫–∞–∑–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ</button>
            <button class="button" onclick="sendData()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –±–æ—Ç—É</button>
            <button class="button" onclick="closeApp()">–ó–∞–∫—Ä—ã—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ</button>
        </div>
        
        <!-- –ü–∞–Ω–µ–ª—å –æ—Ç–ª–∞–¥–∫–∏ -->
        <div class="card">
            <h2>üêõ –û—Ç–ª–∞–¥–∫–∞</h2>
            <div id="debug-info" style="height: 150px; overflow-y: auto; background: #1a1a1a; color: #00ff00; padding: 10px; border-radius: 5px; font-family: 'Courier New', monospace; font-size: 12px; border: 1px solid #333;"></div>
            <button class="button" onclick="clearDebug()">–û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥</button>
            <button class="button" onclick="showDebugInfo()">–ü–æ–∫–∞–∑–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é</button>
            <button class="button" onclick="testSendData()">–¢–µ—Å—Ç –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö</button>
            <button class="button" onclick="testButton()">–¢–µ—Å—Ç –∫–Ω–æ–ø–∫–∏</button>
        </div>
        
        <div class="info">
            <strong>–í–µ—Ä—Å–∏—è Telegram WebApp:</strong> <span id="version"></span><br>
            <strong>–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞:</strong> <span id="platform"></span>
        </div>
    </div>

    <script>
        let counter = 0;
        let tg = null;
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è —Å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ
        function debugLog(message) {
            const timestamp = new Date().toLocaleTimeString();
            console.log(`[${timestamp}] ${message}`);
            
            const debugElement = document.getElementById('debug-info');
            if (debugElement) {
                debugElement.innerHTML += `<div>${timestamp}: ${message}</div>`;
                debugElement.scrollTop = debugElement.scrollHeight;
            }
        }
        
        // –ü—Ä–æ—Å—Ç–æ–π —Ç–µ—Å—Ç –∫–Ω–æ–ø–∫–∏
        function testButton() {
            debugLog('üîò –ö–Ω–æ–ø–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç!');
            alert('–ö–Ω–æ–ø–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç!');
        }
        
        // –ñ–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ Telegram WebApp
        function waitForTelegram() {
            if (window.Telegram && window.Telegram.WebApp) {
                debugLog("‚úÖ Telegram WebApp –∑–∞–≥—Ä—É–∂–µ–Ω!");
                tg = window.Telegram.WebApp;
                initApp();
            } else {
                debugLog("‚è≥ –ñ–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ Telegram WebApp...");
                setTimeout(waitForTelegram, 100);
            }
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        function initApp() {
            debugLog("üîß –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å...");
            
            if (tg) {
                tg.ready();
                tg.expand();
                debugLog("‚úÖ tg.ready() –∏ tg.expand() –≤—ã–ø–æ–ª–Ω–µ–Ω—ã");
                
                // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≥–ª–∞–≤–Ω–æ–π –∫–Ω–æ–ø–∫–∏
                tg.MainButton.text = "–û—Ç–ø—Ä–∞–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ";
                tg.MainButton.show();
                tg.MainButton.onClick(() => {
                    debugLog("üîò –ì–ª–∞–≤–Ω–∞—è –∫–Ω–æ–ø–∫–∞ –Ω–∞–∂–∞—Ç–∞");
                    sendData();
                });
                debugLog("‚úÖ –ì–ª–∞–≤–Ω–∞—è –∫–Ω–æ–ø–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞");
            }
            
            // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
            displayUserInfo();
            
            if (tg) {
                document.getElementById('version').textContent = tg.version || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ';
                document.getElementById('platform').textContent = tg.platform || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ';
                debugLog("üì± –í–µ—Ä—Å–∏—è: " + tg.version);
                debugLog("üñ•Ô∏è –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞: " + tg.platform);
            }
            
            debugLog("‚úÖ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞");
        }
        
        // –§—É–Ω–∫—Ü–∏–∏ —Å—á–µ—Ç—á–∏–∫–∞
        function incrementCounter() {
            counter++;
            document.getElementById('counter').textContent = counter;
            debugLog("‚ûï –°—á–µ—Ç—á–∏–∫: " + counter);
            
            if (tg && tg.HapticFeedback) {
                tg.HapticFeedback.impactOccurred('light');
            }
        }
        
        function resetCounter() {
            counter = 0;
            document.getElementById('counter').textContent = counter;
            debugLog("üîÑ –°—á–µ—Ç—á–∏–∫ —Å–±—Ä–æ—à–µ–Ω");
            
            if (tg && tg.HapticFeedback) {
                tg.HapticFeedback.notificationOccurred('success');
            }
        }
        
        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
        function displayUserInfo() {
            const userInfoElement = document.getElementById('userInfo');
            
            if (tg && tg.initDataUnsafe && tg.initDataUnsafe.user) {
                const user = tg.initDataUnsafe.user;
                userInfoElement.innerHTML = `
                    <strong>–ò–º—è:</strong> ${user.first_name || '–ù–µ —É–∫–∞–∑–∞–Ω–æ'}<br>
                    <strong>–§–∞–º–∏–ª–∏—è:</strong> ${user.last_name || '–ù–µ —É–∫–∞–∑–∞–Ω–æ'}<br>
                    <strong>Username:</strong> @${user.username || '–ù–µ —É–∫–∞–∑–∞–Ω'}<br>
                    <strong>ID:</strong> ${user.id}<br>
                    <strong>–Ø–∑—ã–∫:</strong> ${user.language_code || '–ù–µ —É–∫–∞–∑–∞–Ω'}
                `;
                debugLog("üë§ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ –∑–∞–≥—Ä—É–∂–µ–Ω–∞");
            } else {
                userInfoElement.textContent = '–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞';
                debugLog("‚ùå –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞");
            }
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
        function showAlert() {
            const message = `–ü—Ä–∏–≤–µ—Ç! –°—á–µ—Ç—á–∏–∫ —Å–µ–π—á–∞—Å —Ä–∞–≤–µ–Ω ${counter}`;
            debugLog("üí¨ –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ: " + message);
            
            if (tg) {
                tg.showAlert(message);
            } else {
                alert(message);
            }
        }
        
        // –û—Ç–ø—Ä–∞–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –±–æ—Ç—É
        function sendData() {
            debugLog("üì§ –ù–∞—á–∏–Ω–∞–µ–º –æ—Ç–ø—Ä–∞–≤–∫—É –¥–∞–Ω–Ω—ã—Ö...");
            
            if (!tg) {
                debugLog("‚ùå tg –æ–±—ä–µ–∫—Ç –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω!");
                alert("–û—à–∏–±–∫–∞: Telegram WebApp –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω");
                return;
            }
            
            if (!tg.initData || tg.initData.length === 0) {
                debugLog("‚ùå initData –ø—É—Å—Ç - –æ—Ç–ø—Ä–∞–≤–∫–∞ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–∞");
                alert("‚ùå –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–æ. –û—Ç–∫—Ä–æ–π—Ç–µ –µ–≥–æ —á–µ—Ä–µ–∑ –±–æ—Ç–∞!");
                return;
            }
            
            const data = {
                counter: counter,
                timestamp: new Date().toISOString(),
                user_id: tg.initDataUnsafe?.user?.id,
                from_telegram: true
            };
            
            debugLog("üìã –î–∞–Ω–Ω—ã–µ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏: " + JSON.stringify(data));
            
            try {
                tg.sendData(JSON.stringify(data));
                debugLog("‚úÖ –î–∞–Ω–Ω—ã–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã!");
                if (tg.showAlert) {
                    tg.showAlert("–î–∞–Ω–Ω—ã–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã –±–æ—Ç—É!");
                }
            } catch (error) {
                debugLog("üí• –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏: " + error.message);
                alert("–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏: " + error.message);
            }
        }
        
        // –ó–∞–∫—Ä—ã—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
        function closeApp() {
            debugLog("üö™ –ó–∞–∫—Ä—ã–≤–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ");
            if (tg) {
                tg.close();
            }
        }
        
        // –§—É–Ω–∫—Ü–∏–∏ –æ—Ç–ª–∞–¥–∫–∏
        function clearDebug() {
            document.getElementById('debug-info').innerHTML = '';
            debugLog("üßπ –õ–æ–≥ –æ—á–∏—â–µ–Ω");
        }
        
        function showDebugInfo() {
            debugLog("üìä === –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê ===");
            debugLog("üîç window.Telegram: " + (!!window.Telegram));
            debugLog("üîç tg –æ–±—ä–µ–∫—Ç: " + (!!tg));
            
            if (!tg) {
                debugLog("‚ùå –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –û–®–ò–ë–ö–ê: tg –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω!");
                return;
            }
            
            debugLog("üì± –í–µ—Ä—Å–∏—è: " + (tg.version || '–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'));
            debugLog("üñ•Ô∏è –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞: " + (tg.platform || '–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'));
            debugLog("üîë initData –µ—Å—Ç—å: " + (!!tg.initData));
            debugLog("üîë initData –¥–ª–∏–Ω–∞: " + (tg.initData ? tg.initData.length : 0));
            debugLog("üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –µ—Å—Ç—å: " + (!!tg.initDataUnsafe?.user));
            debugLog("üì§ sendData –¥–æ—Å—Ç—É–ø–µ–Ω: " + (typeof tg.sendData === 'function'));
            debugLog("üåê URL: " + window.location.href);
            
            if (!tg.initData || tg.initData.length === 0) {
                debugLog("üö® –ü–†–û–ë–õ–ï–ú–ê: initData –ø—É—Å—Ç!");
                debugLog("üö® –û—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –±–æ—Ç–∞!");
            } else {
                debugLog("‚úÖ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≥–æ—Ç–æ–≤–æ –∫ –æ—Ç–ø—Ä–∞–≤–∫–µ –¥–∞–Ω–Ω—ã—Ö");
            }
            
            debugLog("üìä === –ö–û–ù–ï–¶ –î–ò–ê–ì–ù–û–°–¢–ò–ö–ò ===");
        }
        
        function testSendData() {
            debugLog("üß™ === –¢–ï–°–¢ –û–¢–ü–†–ê–í–ö–ò ===");
            
            if (!tg) {
                debugLog("‚ùå tg –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω");
                return;
            }
            
            if (!tg.initData || tg.initData.length === 0) {
                debugLog("‚ùå initData –ø—É—Å—Ç");
                alert("‚ùå –û—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –±–æ—Ç–∞!");
                return;
            }
            
            const testData = {
                test: true,
                message: "–¢–µ—Å—Ç",
                counter: counter
            };
            
            debugLog("üì§ –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ: " + JSON.stringify(testData));
            
            try {
                tg.sendData(JSON.stringify(testData));
                debugLog("‚úÖ –¢–µ—Å—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω!");
            } catch (error) {
                debugLog("üí• –û—à–∏–±–∫–∞: " + error.message);
            }
        }
        
        // –ó–∞–ø—É—Å–∫ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', function() {
            debugLog("üöÄ DOM –∑–∞–≥—Ä—É–∂–µ–Ω");
            waitForTelegram();
        });
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏–π Telegram
        window.addEventListener('load', function() {
            if (tg) {
                tg.onEvent('themeChanged', function() {
                    debugLog("üé® –¢–µ–º–∞ –∏–∑–º–µ–Ω–µ–Ω–∞");
                });
            }
        });
    </script>
</body>
</html>
